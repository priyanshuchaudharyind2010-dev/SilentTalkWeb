<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Silent Talk</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body { font-family: Arial; background:#111; color:#fff; }
#chat { display:none; }
input,button { padding:10px; margin:5px; width:90%; }
.msg { background:#222; padding:8px; margin:5px; border-radius:5px; }
.status { font-size:12px; color:lightgreen; }
</style>
</head>

<body>

<!-- LOGIN -->
<div id="login">
  <h2>Silent Talk ðŸ”’</h2>
  <input id="pass" type="password" placeholder="Password">
  <button onclick="login()">Enter</button>
</div>

<!-- CHAT -->
<div id="chat">
  <h3>Private Chat</h3>
  <div id="userStatus" class="status">Checking status...</div>
  <div id="messages"></div>
  <input id="msg" placeholder="Type message">
  <button onclick="send()">Send</button>
</div>

<script>
/* ðŸ”¥ FIREBASE CONFIG */
const firebaseConfig = {
  apiKey: "AIzaSyDMCOAAmH39p6ZG2ILTwvLGRUKgKXHQ",
  authDomain: "silenttalkweb-6835a.firebaseapp.com",
  databaseURL: "https://silenttalkweb-6835a-default-rtdb.firebaseio.com",
  projectId: "silenttalkweb-6835a",
  storageBucket: "silenttalkweb-6835a.appspot.com",
  messagingSenderId: "982126283640",
  appId: "1:982126283640:web:fa53b0642b05fd847168d"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* LOGIN */
function login(){
  if(document.getElementById("pass").value === "cutie29"){
    document.getElementById("login").style.display="none";
    document.getElementById("chat").style.display="block";
  }
}

/* USER ID */
const userId = "user_" + Math.floor(Math.random()*100000);
const statusRef = db.ref("status/" + userId);

/* ONLINE / OFFLINE */
db.ref(".info/connected").on("value", snap => {
  if(snap.val() === true){
    statusRef.set("online");
    statusRef.onDisconnect().set("offline");
  }
});

/* SHOW ONLINE USERS */
db.ref("status").on("value", snap=>{
  let online = [];
  snap.forEach(s=>{
    if(s.val()==="online") online.push(s.key);
  });
  document.getElementById("userStatus").innerText =
    "Online users: " + online.length;
});

/* CHAT */
const chatRef = db.ref("chat");

function send(){
  let text = document.getElementById("msg").value;
  if(text.trim() !== ""){
    chatRef.push({
      user:userId,
      msg:text,
      time:Date.now()
    });
    document.getElementById("msg").value="";
  }
}

chatRef.on("child_added", snap=>{
  let d = snap.val();
  let div = document.createElement("div");
  div.className="msg";
  div.innerText = d.user + ": " + d.msg;
  document.getElementById("messages").appendChild(div);

  /* ALERT (jab site open ho) */
  if(document.visibilityState === "visible"){
    alert("ðŸ“© New message aaya hai!");
  }
});
</script>

</body>
</html>
