<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Silent Talk</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
body {
  margin:0;
  font-family: Arial, sans-serif;
  background:#0f0f0f;
  color:#fff;
}
#login, #chat {
  max-width:500px;
  margin:auto;
  padding:15px;
}
input, button {
  width:100%;
  padding:10px;
  margin-top:8px;
  border:none;
  border-radius:5px;
}
button {
  background:#00bcd4;
  color:#000;
  font-weight:bold;
}
#messages {
  height:60vh;
  overflow-y:auto;
  margin-top:10px;
}
.msg {
  background:#1e1e1e;
  padding:8px;
  border-radius:6px;
  margin-bottom:6px;
}
.msg img, .msg video {
  max-width:100%;
  border-radius:6px;
}
#status {
  font-size:12px;
  color:#0f0;
}
</style>
</head>

<body>

<div id="login">
  <h2>Silent Talk</h2>
  <input id="pass" type="password" placeholder="Enter password">
  <button onclick="login()">Enter</button>
</div>

<div id="chat" style="display:none;">
  <h3>Private Chat</h3>
  <div id="status">Online users: 0</div>
  <div id="messages"></div>
  <input id="msgInput" placeholder="Type message or paste photo/video link">
  <button onclick="send()">Send</button>
</div>

<script>
// ðŸ”¥ Firebase config (TUMHARA)
firebase.initializeApp({
  apiKey: "AIzaSyDMCOAamH396pZG2IILTwYLGRUKIgKXHQ",
  authDomain: "silenttalkweb-6835a.firebaseapp.com",
  databaseURL: "https://silenttalkweb-6835a-default-rtdb.firebaseio.com",
  projectId: "silenttalkweb-6835a"
});

const db = firebase.database();

// LOGIN
function login(){
  if(document.getElementById("pass").value === "cutie"){
    document.getElementById("login").style.display="none";
    document.getElementById("chat").style.display="block";
  } else {
    alert("Wrong password");
  }
}

// USERNAME
let username = localStorage.getItem("username");
if(!username){
  username = "User_" + Math.floor(Math.random()*10000);
  localStorage.setItem("username", username);
}

// ONLINE STATUS
const statusRef = db.ref("status/"+username);
db.ref(".info/connected").on("value", snap=>{
  if(snap.val()){
    statusRef.set("online");
    statusRef.onDisconnect().set("offline");
  }
});
db.ref("status").on("value", snap=>{
  let online=0;
  snap.forEach(s=>{
    if(s.val()==="online") online++;
  });
  document.getElementById("status").innerText = "Online users: "+online;
});

// SEND MESSAGE
function send(){
  const text = msgInput.value.trim();
  if(text==="") return;
  db.ref("messages").push({
    user: username,
    text: text
  });
  msgInput.value="";
}

// RECEIVE
db.ref("messages").limitToLast(50).on("child_added", snap=>{
  const d = snap.val();
  const div = document.createElement("div");
  div.className="msg";

  if(d.text.match(/\.(jpg|jpeg|png|gif)$/i)){
    div.innerHTML = "<b>"+d.user+"</b><br><img src='"+d.text+"'>";
  } else if(d.text.match(/\.(mp4|webm)$/i)){
    div.innerHTML = "<b>"+d.user+"</b><br><video controls src='"+d.text+"'></video>";
  } else {
    div.innerHTML = "<b>"+d.user+":</b> "+d.text;
  }

  messages.appendChild(div);
  messages.scrollTop = messages.scrollHeight;
});
</script>

</body>
</html>
